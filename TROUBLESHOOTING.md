# Windows版Second Meトラブルシューティングガイド

このドキュメントは、Windows環境でSecond Meを実行する際に発生する可能性のある問題と、その解決方法について説明します。

## 目次

1. [推奨起動方法](#推奨起動方法)
2. [一般的なエラーと解決策](#一般的なエラーと解決策)
3. [完全クリーンアップ手順](#完全クリーンアップ手順)
4. [起動スクリプトについて](#起動スクリプトについて)
5. [トラブルシューティングのヒント](#トラブルシューティングのヒント)

## 推奨起動方法

Windows環境でSecond Meを問題なく実行するための推奨方法は以下の通りです：

1. プロジェクトのルートディレクトリで、以下のコマンドを実行します：
   ```
   ultimate-fix.bat
   ```

このスクリプトは、以下を自動的に実行します：
- 既存のプロセスを終了
- 使用中のポートを解放
- バックエンド接続のための環境変数を設定
- CORSプロキシスクリプトを正しく生成
- 適切な順序でサービスを起動（バックエンド→CORSプロキシ→フロントエンド）

## 一般的なエラーと解決策

| エラーメッセージ | 考えられる原因 | 解決策 |
|------------|------------|--------|
| `TypeError: (0 , react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV) is not a function` | Next.js 14とReact 18の互換性問題 | 完全クリーンアップを実行し、ultimate-fix.batを使用 |
| `SyntaxError: Identifier 'createProxyMiddleware' has already been declared` | CORSプロキシスクリプトの問題 | CORSプロキシファイルを削除し、ultimate-fix.batで再生成 |
| `Module not found: Can't resolve 'class-variance-authority'` | UI依存関係の不足 | フロントエンド依存関係を再インストール |
| `バックエンドサーバー接続エラー (http://localhost:8002)` | CORSプロキシの問題、または起動順序の問題 | ultimate-fix.batを使用して正しい順序で起動 |
| `You are using a non-standard "NODE_ENV" value` | 環境変数の設定ミス | ultimate-fix.batを使用（正しいNODE_ENV値を設定） |
| `ポートXXXXは使用中です` | 他のプロセスがポートを使用中 | ultimate-fix.batを使用（ポート開放機能あり） |

## 完全クリーンアップ手順

深刻な問題が発生した場合や、何度も再起動しても解決しない場合は、以下の完全クリーンアップ手順を実行してください：

1. すべての実行中のSecond Meプロセスを終了
   ```
   taskkill /f /fi "WINDOWTITLE eq Second-Me*"
   ```

2. フロントエンドをクリーンアップ
   ```
   cd lpm_frontend
   clean-all.bat
   ```

3. 依存関係を再インストール
   ```
   npm install
   cd ..
   ```

4. 再度修正スクリプトを実行
   ```
   ultimate-fix.bat
   ```

## 起動スクリプトについて

プロジェクトには以下の起動スクリプトが含まれています：

1. **ultimate-fix.bat**（推奨）
   - すべての既知の問題に対応した包括的な修正スクリプト
   - 旧CORSプロキシを削除し、正しく再生成
   - 適切なタイミング制御と詳細なエラーメッセージ

2. **fix-and-start.bat**
   - 基本的な依存関係の問題を修正するスクリプト
   - 不足しているパッケージがある場合に便利

3. **start-with-cors.bat**（非推奨）
   - 最小限のCORS機能で起動するスクリプト
   - 新しい修正が反映されていない場合があります

4. **lpm_frontend/clean-all.bat**
   - フロントエンド環境を完全にクリーンアップするスクリプト
   - 依存関係の問題をリセットするために使用

## トラブルシューティングのヒント

**1. バックエンド接続の問題**

フロントエンドがバックエンドに接続できない場合：
- バックエンドが正常に起動しているか確認（コンソールウィンドウを確認）
- CORSプロキシが正常に起動しているか確認
- ブラウザで直接CORSプロキシに接続してみる：`http://localhost:8003/api/profiles`

**2. 依存関係の問題**

新しいエラーメッセージが表示される場合：
- 完全クリーンアップを実行
- フロントエンドディレクトリで`npm install`を実行
- package.jsonに記載されている依存関係が正しいバージョンになっているか確認

**3. ポートの競合**

指定されたポートが既に使用されている場合：
- ultimate-fix.batを使用（自動的にポートを解放）
- 手動でプロセスを終了：`taskkill /f /pid <プロセスID>`
- .envファイルでポート番号を変更

**4. 起動順序の問題**

サービスの起動順序が重要です：
1. バックエンド
2. CORSプロキシ
3. フロントエンド

それぞれのサービスが完全に初期化されるまで待ってから次のサービスを起動するようにしてください。

**5. 環境変数の問題**

環境変数が正しく設定されていることを確認：
- NODE_ENV=development
- NEXT_PUBLIC_BACKEND_URL=http://localhost:8003（CORSプロキシのポート）

## サポート

さらに支援が必要な場合は、GitHubリポジトリにイシューを作成してください。その際、発生したエラーメッセージのスクリーンショットと、実行したコマンドを含めると問題解決が早くなります。
