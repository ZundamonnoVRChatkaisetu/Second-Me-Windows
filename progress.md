# Second-Me-Windows 進捗管理

## 最新のアップデート (2025/3/23)
- リポジトリの現状確認を実施
- 「第2の自分を作る」フローの改善計画を具体化
- プロファイル作成ページ(profiles/create.tsx)のUIを改善
  - 「第2の自分」の概念をより明確に説明する説明文を追加
  - テキストラベルを「プロファイル」から「第2の自分」に変更
  - 作成後の遷移先をチャットページに変更するオプションを追加
  - プロファイル作成後に自動的にそのプロファイルをアクティブにする機能を追加

## 現在の状況
- プロジェクトの初期分析完了
- Next.jsアプリケーションが起動し、基本UI表示を確認
- バックエンドサーバーはポート8002で起動中
- CORSプロキシはポート8003で起動中
- フロントエンドはポート3000で起動中
- モデル検出・選択機能の実装完了
- 設定ページの追加完了
- ルーティング問題の修正完了
- ドキュメントページの修正完了
- ファイルアップロード機能の実装完了
- ローカルモデルを使用したチャット機能の実装完了
- 複数の「第2の自分」（プロファイル機能）の実装完了
- 「第2の自分を作る」ボタンとプロファイル作成の連携実装済み（NavigationHeader.tsxリンク先変更）
- create.tsxページでのプロファイル作成ページへのリダイレクト実装済み
- プロファイル作成ページのUI改善完了（「第2の自分」の概念の明確化）
- 作成後の遷移先をチャットページに変更するオプション実装完了

## 実装計画（現在進行中）

### 第2の自分作成フローの改善

**目的:**
「第2の自分を作る」機能とプロファイル作成を最適化し、ユーザー体験をさらに向上させる

**現状の分析:**
1. 「第2の自分を作る」ボタンはすでに`/profiles/create`に正しくリンクされている
2. `/create`ページは適切に`/profiles/create`にリダイレクトする実装が完了している
3. プロファイル作成ページにモデル選択機能が実装されている
4. 「第2の自分」の概念をより明確に伝えるUIの改善が完了

**改善内容:**
1. ✅ プロファイル作成ページのUIをよりSecond Meの概念に合わせて再設計
2. ✅ プロファイル作成後の動線を改善（チャットページに直接遷移するオプションを追加）
3. プロファイル作成プロセスのステップ化（複数ページに分割してウィザード形式に）

**次のステップ:**
1. プロファイル作成プロセスをウィザード形式に拡張する準備（必要なコンポーネントの設計）
   - ステップ1: 基本情報の入力（名前と目的）
   - ステップ2: モデル選択とパラメータ設定
   - ステップ3: パーソナリティ設定（オプション）
   - ステップ4: 完了と次のステップ（メモリーやデータのアップロード案内）

**完了条件:**
- ✅ 「第2の自分を作る」から「プロファイル作成」までがよりシームレスで直感的な体験となっている
- ✅ プロファイル作成ページのUIが「第2の自分」の概念をより明確に反映している
- ✅ プロファイル作成後のユーザー動線が最適化されている
- ウィザード形式のプロファイル作成プロセスが実装されている（今後の課題）

## 解決済みの問題
1. **エンドポイント不一致の問題**
   - バックエンドに `/api/health` エンドポイントを追加し、フロントエンドとの互換性を確保

2. **Next.jsのImage コンポーネントの非推奨props使用**
   - `layout`と`objectFit`プロパティを`fill`と`style={{ objectFit: 'cover' }}`に更新
   - `fetchPriority`の代わりに`priority`プロップを使用

3. **モデル対応の実装**
   - バックエンドにモデル一覧取得APIエンドポイントを追加
   - モデル選択UIコンポーネント(ModelSelector)の実装
   - 設定画面への統合

4. **外部ライブラリ依存関係の修正**
   - `lucide-react` 依存を削除し、ユニコード絵文字とCSSで代替
   - `shadcn/ui`の`Select`コンポーネント依存を削除し、ネイティブの`select`で代替

5. **ルーティングの問題**
   - `AnimatedPage`と`AnimationWrapper`コンポーネントを削除
   - `framer-motion`依存を削除
   - シンプルなレイアウト構造に変更

6. **ドキュメントページの修正**
   - 正しいインポート文に修正（`Layout`コンポーネントの参照方法）
   - 余分な依存関係の削除

7. **ファイルアップロードAPIエンドポイントの不足**
   - バックエンド(app.py)に`/api/upload`エンドポイントを追加
   - ファイルの保存処理を実装（UUID付きの安全なファイル名を使用）
   - アップロードディレクトリとカテゴリ別のサブディレクトリを自動作成する機能を追加
   - ファイル一覧取得用の`/api/files`エンドポイントも追加

8. **チャット機能がモデルと連携していない問題**
   - Ollamaから`/models`ディレクトリ内のローカルモデルを使用する方式に変更
   - バックエンドの`/api/chat`エンドポイントを更新し、llama.cpp経由でローカルモデルを呼び出す実装に変更
   - `ModelSelector`コンポーネントを更新し、ローカルモデルを検出・選択できるように修正
   - エラーハンドリングを強化（モデル未選択時の処理、llama.cpp実行確認など）

9. **複数の「第2の自分」を作成できない問題**
   - プロファイル管理システムを実装
   - 個別のプロファイルごとに設定、モデル、メモリー、トレーニングデータを管理
   - プロファイル作成・切替UI
   - プロファイル情報の永続化

10. **「第2の自分を作る」機能とプロファイル作成の連携不足**
    - 「第2の自分を作る」ボタンのリンク先を`/profiles/create`に変更
    - createページにリダイレクト機能を実装

11. **プロファイル作成ページのUIがSecond Meの概念を十分に反映していない問題**
    - プロファイル作成ページのUIテキストを「第2の自分」に変更
    - 「第2の自分」の概念説明を追加
    - 作成後の遷移先をチャットページに変更するオプションを追加
    - プロファイル作成後に自動的にそのプロファイルをアクティブにする機能を追加

## 未解決の問題
1. **プロファイル管理とチャット機能の連携が不十分**
   - プロファイル切り替え後のチャット履歴の自動更新が実装されていない
   - プロファイルごとのコンテキスト管理が不十分

2. **プロファイル作成プロセスがシンプルで機能制限がある**
   - ウィザード形式の段階的なプロファイル作成プロセスが未実装
   - パーソナリティや詳細設定のオプションが限られている

## 次のアクション
1. **プロファイル作成プロセスのステップ化（計画段階）**
   - マルチステップフォームのための基本コンポーネント設計
   - ステップごとのUIデザイン
   - ステップ間のデータ保持と検証機能の実装計画

2. **プロファイル詳細ページの実装**
   - プロファイル情報の編集機能
   - プロファイル削除機能
   - プロファイル固有のメモリー・トレーニングデータの管理

3. **README.mdの更新**
   - ローカルモデル選択機能についての説明を追加
   - プロファイル機能の説明を追加
   - インストール・セットアップ手順の更新
   - ファイルアップロード機能の説明を追加
   - チャット機能の使い方の説明を追加

4. **トレーニング機能の実装**
   - ユーザーデータを使ったモデルファインチューニング機能の実装
   - トレーニング進捗表示の実装
   - トレーニング済みモデルの保存・管理機能

5. **チャットUI/UXの改善**
   - チャット履歴の保存機能の追加
   - 長文応答の折りたたみ/展開機能
   - コード表示の改善（シンタックスハイライトなど）

6. **UI/UXの全体的な改善**
   - より直感的なナビゲーション
   - モバイル対応の強化
   - ダークモードの完全サポート

## リスク
- モデルファイルが存在しない場合の処理
- llama.cppが正しく機能しない場合のフォールバック処理
- 新しいコンポーネントを追加する際の依存関係管理
- アップロードディレクトリに関する権限問題が発生する可能性
- 大量データの処理やモデルの推論時間が長い場合のタイムアウト問題
- プロファイルのデータ構造変更時の互換性問題

## 技術的詳細
- バックエンドサーバーはFlaskベースでポート8002で実行中
- CORSプロキシはExpressベースでポート8003で実行中
- フロントエンドはNext.jsベースでポート3000で実行中
- モデルは`/models`ディレクトリ内に配置
- チャット機能はllama.cppを使用してローカルモデルで応答を生成
- アップロードファイルは`uploads/[カテゴリ名]/`ディレクトリに保存
- プロファイルデータは`/profiles/[プロファイルID]/`ディレクトリに保存
- 各プロファイルは固有のメモリーとトレーニングデータを持つ

## 実装したAPIエンドポイント
1. `/api/models` - 利用可能なローカルモデルのリストを取得
2. `/api/models/set` - 使用するモデルを設定
3. `/api/upload` - ファイルアップロード処理
4. `/api/files` - アップロードされたファイル一覧を取得
5. `/api/chat` - ローカルモデルを使用したチャット処理
6. `/api/profiles` - プロファイル一覧を取得
7. `/api/profiles/create` - 新しいプロファイルを作成
8. `/api/profiles/activate` - プロファイルをアクティブにする
9. `/api/profiles/update` - プロファイル情報を更新
10. `/api/profiles/delete` - プロファイルを削除
11. `/api/memory` - プロファイル固有のメモリーを管理

## 追加コンポーネント
1. `ModelSelector.tsx` - モデルを選択するUIコンポーネント
2. `ProfileSelector.tsx` - プロファイルを選択・管理するUIコンポーネント
3. `settings.tsx` - 設定ページ
4. `profiles/index.tsx` - プロファイル管理ページ
5. `profiles/create.tsx` - プロファイル作成ページ

## 更新したコンポーネント
1. `app.py` - バックエンドにAPIエンドポイントを追加（プロファイル管理、ファイルアップロード、ローカルモデル対応）
2. `ModelSelector.tsx` - OllamaからローカルモデルのAPIに対応するよう更新
3. `NavigationHeader.tsx` - プロファイル選択機能を追加、「第2の自分を作る」ボタンのリンク先を`/profiles/create`に変更
4. `StepCard.tsx` - Next.js Image コンポーネントの非推奨プロップを更新
5. `Layout.tsx` - アニメーション関連の依存を削除しシンプル化
6. `docs.tsx` - インポート文を修正し、Layoutコンポーネントの参照方法を更新
7. `create.tsx` - プロファイル作成ページへのリダイレクト機能を実装
8. `profiles/create.tsx` - UIを「第2の自分」の概念に合わせて改善、作成後の遷移オプションを追加
